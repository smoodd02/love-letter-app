<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>G·ª≠i Th∆∞ T√¨nh Online</title>
<style>
  body {
    font-family: sans-serif;
    max-width: 480px;
    margin: 2rem auto;
    background: #fff0f5;
    padding: 1.5rem;
    border-radius: 15px;
  }
  label {
    display:block; margin-top: 1rem; font-weight: bold;
  }
  input, textarea, select, button {
    width: 100%; padding: 0.6rem; margin-top: 0.3rem;
    border-radius: 8px; border: 1px solid #ccc; font-size: 1rem;
  }
  textarea {
    height: 120px; resize: vertical;
    font-family: 'Dancing Script', cursive;
  }
  button {
    background:#e91e63; color:#fff; border:none;
    font-weight: bold; border-radius: 10px;
    cursor: pointer;
    font-size: 1.1rem;
  }
  #resultLink {
    margin-top: 1rem;
    background: #ffe6f0;
    padding: 0.8rem;
    border-radius: 8px;
    word-break: break-word;
  }
  #previewImages {
    display: flex;
    overflow-x: auto;
    gap: 10px;
    margin-top: 0.8rem;
  }
  #previewImages img {
    height: 80px;
    border-radius: 8px;
    cursor: pointer;
  }
  #emojiPicker {
    margin-top: 0.5rem;
    background: #fff0f5;
    border: 1px solid #e91e63;
    border-radius: 8px;
    padding: 0.3rem;
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }
  #emojiPicker span {
    font-size: 1.5rem;
    cursor: pointer;
    user-select: none;
  }
</style>
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script&display=swap" rel="stylesheet" />
</head>
<body>

<h2>G·ª≠i Th∆∞ T√¨nh Online</h2>

<label for="recipient">Ng∆∞·ªùi nh·∫≠n:</label>
<input type="text" id="recipient" placeholder="T√™n ng∆∞·ªùi nh·∫≠n..." />

<label for="content">N·ªôi dung th∆∞:</label>
<textarea id="content" placeholder="Vi·∫øt th∆∞ ·ªü ƒë√¢y..."></textarea>

<label>Ch√®n emoji:</label>
<div id="emojiPicker"></div>

<label for="imageUpload">Ch·ªçn ·∫£nh (c√≥ th·ªÉ ch·ªçn nhi·ªÅu ·∫£nh):</label>
<input type="file" id="imageUpload" accept="image/*" multiple />

<div id="previewImages"></div>

<label for="sender">Ng∆∞·ªùi g·ª≠i:</label>
<input type="text" id="sender" placeholder="T√™n ng∆∞·ªùi g·ª≠i..." />

<label for="password">M·∫≠t kh·∫©u (d√πng ƒë·ªÉ m·ªü th∆∞):</label>
<input type="password" id="password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u ri√™ng..." />

<label for="font">Ch·ªçn font ch·ªØ vi·∫øt tay:</label>
<select id="font">
  <option value="'Dancing Script', cursive" selected>Dancing Script</option>
  <option value="'Pacifico', cursive">Pacifico</option>
  <option value="'Indie Flower', cursive">Indie Flower</option>
  <option value="'Great Vibes', cursive">Great Vibes</option>
</select>

<button id="createBtn">T·∫°o Th∆∞</button>

<div id="resultLink" style="display:none;"></div>

<script>
  // Load th√™m font Google Fonts
  const fontsToLoad = [
    "https://fonts.googleapis.com/css2?family=Pacifico&display=swap",
    "https://fonts.googleapis.com/css2?family=Indie+Flower&display=swap",
    "https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap"
  ];
  fontsToLoad.forEach(url => {
    const link = document.createElement("link");
    link.rel = "stylesheet";
    link.href = url;
    document.head.appendChild(link);
  });

  // Emoji Facebook-like ƒë∆°n gi·∫£n
  const emojis = ["üòä","üòç","üòò","üòâ","üò¢","üò≠","üò°","üò±","üëç","‚ù§Ô∏è"];
  const emojiPicker = document.getElementById("emojiPicker");
  const contentTextarea = document.getElementById("content");
  emojis.forEach(e => {
    const span = document.createElement("span");
    span.textContent = e;
    span.title = "Click ƒë·ªÉ ch√®n emoji";
    span.addEventListener("click", () => {
      // Ch√®n emoji v√†o v·ªã tr√≠ con tr·ªè
      const start = contentTextarea.selectionStart;
      const end = contentTextarea.selectionEnd;
      const text = contentTextarea.value;
      contentTextarea.value = text.slice(0,start) + e + text.slice(end);
      contentTextarea.focus();
      contentTextarea.selectionStart = contentTextarea.selectionEnd = start + e.length;
    });
    emojiPicker.appendChild(span);
  });

  // X·ª≠ l√Ω upload ·∫£nh & preview
  const imageUpload = document.getElementById("imageUpload");
  const previewImages = document.getElementById("previewImages");
  let imageBase64List = [];

  imageUpload.addEventListener("change", () => {
    previewImages.innerHTML = "";
    imageBase64List = [];

    const files = Array.from(imageUpload.files);
    if (files.length === 0) return;

    files.forEach(file => {
      const reader = new FileReader();
      reader.onload = e => {
        imageBase64List.push(e.target.result);
        const img = document.createElement("img");
        img.src = e.target.result;
        previewImages.appendChild(img);
      };
      reader.readAsDataURL(file);
    });
  });

  // T·∫°o th∆∞ & l∆∞u localStorage
  document.getElementById("createBtn").addEventListener("click", () => {
    const recipient = document.getElementById("recipient").value.trim();
    const content = contentTextarea.value.trim();
    const sender = document.getElementById("sender").value.trim();
    const password = document.getElementById("password").value.trim();
    const font = document.getElementById("font").value;

    if (!recipient || !content || !sender || !password) {
      alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!");
      return;
    }

    // Gi·ªõi h·∫°n k√≠ch th∆∞·ªõc l∆∞u localStorage
    if (imageBase64List.length > 10) {
      alert("Ch·ªâ ƒë∆∞·ª£c t·∫£i t·ªëi ƒëa 10 ·∫£nh.");
      return;
    }

    const id = Math.random().toString(36).substring(2, 8);

    const letterData = {
      recipient,
      content,
      sender,
      password,
      font,
      images: imageBase64List
    };

    localStorage.setItem("loveLetter_" + id, JSON.stringify(letterData));

    const baseURL = window.location.origin + window.location.pathname.replace("send.html", "") + "read.html";
    const fullLink = `${baseURL}?id=${id}`;

    const resultDiv = document.getElementById("resultLink");
    resultDiv.style.display = "block";
    resultDiv.innerHTML = `Th∆∞ ƒë√£ t·∫°o! G·ª≠i link n√†y cho ng∆∞·ªùi nh·∫≠n:<br><a href="${fullLink}" target="_blank">${fullLink}</a>`;
  });
</script>
</body>
</html>
